<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Управління опараціями</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>

<div th:replace="fragments/header :: header"></div>

<h2>Запуск операцій</h2>
<p id="statusMessage" style="color: red;"></p>

<form id="operationsForm">
    <label><input type="checkbox" name="updateUserBenchmarkCpu"> Оновити CPU Benchmark</label><br>
    <label><input type="checkbox" name="updateUserBenchmarkGpu"> Оновити GPU Benchmark</label><br>
    <button type="button" onclick="location.href='/gpus'">Оновити дані потужності блоків живлення</button><br><br>
    <label><input type="checkbox" name="updateHotline"> Оновити Hotline</label><br>
    <label><input type="checkbox" name="createPcList"> Створити список ПК</label><br>
    <label><input type="checkbox" name="saveReportToExcel"> Зберегти звіт в Excel</label><br>
    <button type="button" onclick="executeOperation()">Запустити</button>
</form>


<script>
    function executeOperation() {
        let form = document.getElementById("operationsForm");
        let formData = new FormData(form);

        let statusMessage = document.getElementById("statusMessage");
        statusMessage.innerText = "ЧЕКАЙТЕ ЗАКІНЧЕННЯ.";
        statusMessage.style.color = "red";

        fetch("/operations/execute", {
            method: "POST",
            body: new URLSearchParams(new FormData(form))
        })
            .then(response => response.json())
            .then(data => {
                statusMessage.innerText = data.message;
                statusMessage.style.color = data.success ? "green" : "red";
            })
            .catch(error => {
                statusMessage.innerText = "ПОМИЛКА: " + error;
                statusMessage.style.color = "red";
            });
    }
</script>

</body>
</html>
